<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Fl√§chenmelder Flensburg</title>
  
  <!-- Leaflet CSS -->
  <link rel="stylesheet" href="https://unpkg.com/leaflet/dist/leaflet.css" />
  <!-- Leaflet Draw CSS -->
  <link rel="stylesheet" href="https://unpkg.com/leaflet-draw/dist/leaflet.draw.css" />
  <link rel="stylesheet" href="style/style_flensburg.css" />

  <style>
    label {
      display: block;
      margin: 0.5em 0;
    }
    #map {
      height: 400px;
      margin-top: 1em;
      border: 1px solid #ccc;
    }
    .infobox {
      background: #eef6ff;
      border-left: 4px solid #3399ff;
      padding: 1em;
      margin-bottom: 1em;
    }
  </style>
</head>
<body>
 <header>
  <h1>Fl√§chenmeldeformular</h1>
  <p>Stadt Flensburg ‚Äì Stadtenwicklung & Klimaschutz</p>
</header>

  <main>
  
<div class="infobox">
  <h2>üìç Hinweise zur Meldung von Entsiegelungsfl√§chen in Flensburg</h2>
  <p>
    Bitte tragen Sie die Informationen zur versiegelten Fl√§che in das Formular ein und markieren Sie deren Lage auf der Karte. 
    Alle Angaben werden direkt an das Fl√§chenmanagement der Stadt Flensburg √ºbermittelt.
  </p>
  <p>
    Sie k√∂nnen entweder die gesamte Fl√§che zeichnen oder einen einzelnen Punkt setzen. Je vollst√§ndiger und pr√§ziser Ihre Angaben sind, 
    desto besser k√∂nnen wir sie f√ºr die st√§dtische Planung nutzen.
  </p>
  <p>
    Bei R√ºckfragen wenden Sie sich gerne per E-Mail an: 
    <a href="mailto:flaechenmanagement@flensburg.de">flaechenmanagement@flensburg.de</a>
  </p>
</div>

   <div id="kategorie">
  <label for="kategorie">Bitte w√§hlen Sie zuerst aus, ob es sich um einen Vorschlag zur entsiegelung handelt, oder um eine bereits entsiegelte Fl√§che, die gemeldet werden soll. </label>
  <select id="kategorie">
    <option value="">Bitte ausw√§hlen</option>
    <option value="vorschlag">Entsiegelungs Vorschlag</option>
    <option value="entsiegelt">Entsiegelte Fl√§che</option>
  </select>
</div>

  <div id="vorschlagForm" style="display:none;">
  <form id="geoForm" action="https://formspree.io/f/mldbkjne" method="POST">
    <img src="https://www.flensburg.de/layout/_default/assets/img/logo_stadt-flensburg-2016.png?__ts=1454507653" alt="Stadt Flensburg" style="height: 40px; margin-bottom: 0.5em;">
    <label>Name:
      <input type="text" name="name", placeholder="Ihr/Dein Name (Pflichtfeld)", required />
    </label>

     <label>Abteilung:
      <input type="text" name="department", placeholder="Abteilung (Pflichtfeld)", required />
    </label>
	
    <label>Ort / Adresse:
      <input type="text" name="location", placeholder="Adresse der Fl√§che"/>
    </label>
	
    <label>E-Mail:
      <input type="email" name="email", placeholder="Ihre/Deine Email (Pflichtfeld)", required/>
    </label>
    
    <label>Gr√∂√üe (m¬≤):
      <input type="number" name="groesse", placeholder="Gr√∂sse in m2 (ca.)" />
    </label>
    
     <label>Kurzbeschreibung:
      <input type="text" name="kurzbeschreibung" placeholder="Warum ist diese Fl√§che aus Ihrer / Deiner Sicht geeignet?"/>
     </label>

   <div class="upload-area" id="upload-area">
    <p><strong>Foto hierher ziehen</strong> oder klicken, um auszuw√§hlen</p>
    <input type="file" name="photo" id="fileElem" accept="image/*" style="display:none">
    </div>

    <label>Oberfl√§che:
      <select name="oberflaeche">
        <option value="">Auswahl</option>
        <option value="1">Asphalt</option>
        <option value="2">Beton</option>
        <option value="3">Pflaster (gro√üe Fuge)</option>
        <option value="4">Pflaster (kleine Fuge)</option>
        <option value="5">Betonplatten</option>
        <option value="6">Mosaikpflaster</option>
        <option value="7">Gro√üpflaster (Naturstein)</option>
        <option value="8">Kleinpflaster (Naturstein)</option>
        <option value="9">Teilversiegelt</option>
        <option value="10">Anderes</option>
      </select>
    </label>

    <div id="map"></div>
    <input type="hidden" name="geojson" id="geojson" />

    <button type="submit">Absenden</button>
  </form>
  </div>
 
 <div id="enstiegeltForm" style="display:none;">
 </div>

  <!-- Leaflet JS -->
  <script src="https://unpkg.com/leaflet/dist/leaflet.js"></script>
  <!-- Leaflet Draw JS -->
  <script src="https://unpkg.com/leaflet-draw/dist/leaflet.draw.js"></script>
  </main>
   <footer>
    <div class="footer-flex">
      <img src="img/logo.svg" alt="syntopy.network Logo" width="48" height="48" />
      <span>Powered by: &copy; 2025 syntopy.network. Alle Rechte vorbehalten. <a href="impressum.html">Impressum</a></span>
    </div>
  </footer>
  <script>
    const map = L.map('map').setView([54.78431, 9.43961], 14);
    L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
      attribution: '&copy; OpenStreetMap contributors'
    }).addTo(map);

    const drawnItems = new L.FeatureGroup().addTo(map);
    const drawControl = new L.Control.Draw({
      draw: { polygon: true, rectangle: true, marker: true },
      edit: { featureGroup: drawnItems }
    });
    map.addControl(drawControl);

    map.on(L.Draw.Event.CREATED, e => {
      drawnItems.clearLayers();
      drawnItems.addLayer(e.layer);
    });

    const form = document.getElementById('geoForm');
    form.addEventListener('submit', function(e) {
      e.preventDefault(); // stop normal submit

      const layers = drawnItems.getLayers();
      if (!layers.length) {
        alert('Bitte zeichnen Sie eine Fl√§che auf der Karte.');
        return;
      }

      const geometry = layers[0].toGeoJSON().geometry;

      const props = {
        name: form.elements['name'].value,
	department: form.elements['department'].value,
        location: form.elements['location'].value,
        groesse: form.elements['groesse'].value,
        oberflaeche: form.elements['oberflaeche'].value,
        kategorie: document.getElementById('kategorie').value
      };

      const feature = {
        type: 'Feature',
        geometry: geometry,
        properties: props
      };

      document.getElementById('geojson').value = JSON.stringify(feature);
      form.submit();
    });
  </script>
  <script>
document.getElementById('kategorie').addEventListener('change', function() {
  const val = this.value;
  document.getElementById('vorschlagForm').style.display = (val === 'vorschlag') ? 'block' : 'none';
  document.getElementById('entsiegeltForm').style.display = (val === 'entsiegelt') ? 'block' : 'none';
});
</script>
	<script>
const uploadArea = document.getElementById('upload-area');
const fileInput = document.getElementById('fileElem');

uploadArea.addEventListener('click', () => {
  fileInput.click();
});

uploadArea.addEventListener('dragover', (e) => {
  e.preventDefault();
  uploadArea.classList.add('dragover');
});

uploadArea.addEventListener('dragleave', () => {
  uploadArea.classList.remove('dragover');
});

uploadArea.addEventListener('drop', (e) => {
  e.preventDefault();
  uploadArea.classList.remove('dragover');
  
  if (e.dataTransfer.files.length) {
    fileInput.files = e.dataTransfer.files;
    uploadArea.querySelector('p').textContent = `Ausgew√§hlt: ${e.dataTransfer.files[0].name}`;
  }
});

fileInput.addEventListener('change', () => {
  if (fileInput.files.length) {
    uploadArea.querySelector('p').textContent = `Ausgew√§hlt: ${fileInput.files[0].name}`;
  }
});
</script>
</body>
</html>

